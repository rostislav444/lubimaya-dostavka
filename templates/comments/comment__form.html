{% load static %}
{% load i18n %}
<!-- LINKS -->
{% block links %}
<link rel="stylesheet" href="{% static 'css/comment__form.css' %}">
<script src="https://unpkg.com/imask"></script>
{% endblock %}
<!-- CONTENT -->
{% block content %}
<div class="popup__outer comment_form_popup" id="comment_form_popup">
    <div class="popup__conteiner">
        <div class="comment_form__wrapper">
            <p class="h2 upper semibold center pt64 pb32">–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤</p>
          
            <!-- FORM -->
            <form class="form comment_form pb64" id="comment_form" enctype="multipart/form-data" method="post">

                <!-- NAME -->
                <p>
                    <label for="comment_form_first_name">–í–∞—à–µ –∏–º—è</label>
                    <input class="h5" name="first_name" id="comment_form_first_name" type="text" placeholder="–í–∞—à–µ –∏–º—è" data-alert='–í–≤–µ–¥–∏—Ç–µ –í–∞—à–µ –∏–º—è' required>
                </p>
                <!-- PHHONE -->
                <p>
                    <label for="comment_form_first_name">–í–∞—à–µ –∏–º—è</label>
                    <input class="h5" name="phone" id="comment_form_phone" type="text" placeholder="–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" data-alert='–í–≤–µ–¥–∏—Ç–µ –í–∞—à –¢–µ–ª–µ—Ñ–æ–Ω' data-error="–¢–µ–ª–µ—Ñ–æ–Ω –∏–º–µ–µ—Ç –Ω–µ –≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç" required>
                </p>
                <!-- SERVICE -->
                <p>
                    <label for="comment_form_services">–£—Å–ª—É–≥–∞</label>
                    <select name="service" id="comment_form_services" required>
                        {% for service in main_service %}
                            <option value="{{ service.slug }}">{{ service.name }}</option>
                        {% endfor %}
                    </select>
                </p>
                <!-- RATE -->
                <p>
                    <label for="comment_form_rate">–û—Ü–µ–Ω–∫–∞</label>
                    <select name="rate" id="comment_form_rate" required>
                        <option value="5" selected>–û—Ç–ª–∏—á–Ω–æ</option>
                        <option value="4">–•–æ—Ä–æ—à–æ</option>
                        <option value="3">–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
                        <option value="2">–ü–ª–æ—Ö–æ</option>
                        <option value="1">–£–∂–∞—Å–Ω–æ</option>
                    </select>
                </p>
                
                <!-- TEXT -->
                <p class="textarea col-1-3">
                    <textarea 
                    class="h5" id="review-text" name="comment" id="text" 
                    data-alert='–ù–∞–ø–∏—à–∏—Ç–µ –ø–∞—Ä—É —Å–ª–æ–≤ –æ —Ç–æ–≤–∞—Ä–µ'
                    placeholder="–ù–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤ –æ —Ç–æ–≤–∞—Ä–µ..." required></textarea>
                </p>
                <p class="h6 grey col-1-3">{% trans '–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞' %}</p>
                <!-- SUBMIT -->
                <button class="col-1-3 h5 upper comment_confirm" type="submit">{% trans '–û—Ç–ø—Ä–∞–≤–∏—Ç—å' %}</button>
            </form>
        </div>
    </div>
</div>



<script>
    let commentForm = document.getElementById("comment_form");
    let preloader = document.getElementById('comment__preloader')
    let comments = document.querySelector('.comments_list')
    let formWrapper = document.querySelector('.comment_form__wrapper') 
    commentForm.addEventListener('submit', function(event) {
        event.preventDefault();
        // preloader.style.visibility = 'visible'
        
        formData = new FormData(commentForm);
        

        var xhr = new XMLHttpRequest();
            xhr.open("POST", "{% url 'core:comment'%}", false);
            xhr.setRequestHeader("X-CSRFToken",  getCookie('csrftoken') );
            xhr.onload = function(oEvent) {
                if (xhr.status == 200) {
                    let response = JSON.parse(xhr.responseText);
                    comments.innerHTML = response['html'] + comments.innerHTML
                    formWrapper.innerHTML = '<p class="h1 bold green center upper pt64 pb64">–°–ø–∞—Å–∏–±–æ, –í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</p>'
                    
                } else {
                    alert('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ üòû')
                }
            };

            commentForm.style.filter = 'blur(4px)';
            commentForm.style.pointerEvents =  'none';

            xhr.send(formData);
            
    }, false);

    var element = document.querySelector('input[name=phone]');
    var maskOptions = {
        mask: '+{38} (000) 000-00-00',
        lazy: false,
    };
    var mask = IMask(element, maskOptions);
</script>

{% endblock %}
